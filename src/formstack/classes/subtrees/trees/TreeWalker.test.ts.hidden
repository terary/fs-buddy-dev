import { TreeWalker } from "./TreeWalker";
import fifthDegreeBadCircuitFormJson from "../../../../test-dev-resources/form-json/5375703.json";
import { FsTreeField } from "./FsTreeField";
import { TFsFieldAnyJson } from "../../types";
import { TSimpleDictionary } from "../types";
describe("TreeWalker", () => {
  describe("Its Awesome", () => {
    it.only("Should Determine Fifth Degree Interdependency.", () => {
      const fields = fifthDegreeBadCircuitFormJson.fields
        .map((fieldJson) => {
          const f = FsTreeField.fromFieldJson(
            fieldJson as unknown as TFsFieldAnyJson
          );
          return f;
        })
        .reduce((prev, cur) => {
          prev[cur.fieldId] = cur;
          return prev;
        }, {} as { [fieldId: string]: FsTreeField });

      const walker = new TreeWalker(fields);
      const depChain = walker.getDependentsChain("148456739");
      console.log({ depChain });

      expect(walker.getDependentsChain("148456734").sort()).toStrictEqual(
        [
          "148456742",
          "148456741",
          "148456740",
          "148456739",
          "148456734",
          "{circular:148456742}",
        ].sort()
      );
      expect(walker.getDependentsChain("148456740").sort()).toStrictEqual(
        [
          "148456739",
          "148456734",
          "148456742",
          "148456741",
          "148456740",
          "{circular:148456742}",
        ].sort()
      );
      expect(walker.getDependentsChain("148456700")).toStrictEqual([
        "{LEAF:148456700}",
      ]);
      //   expect(walker.getFullPathIndex()).toStrictEqual({
      //     "148456700": "{LEAF:148456700}",
      //     "148456734":
      //       "148456742/148456741/148456740/148456739/{circular:148456734}",
      //     "148456739":
      //       "148456734/148456742/148456741/148456740/{circular:148456739}",
      //     "148456740":
      //       "148456739/148456734/148456742/148456741/{circular:148456740}",
      //     "148456741":
      //       "148456740/148456739/148456734/148456742/{circular:148456741}",
      //     "148456742":
      //       "148456741/148456740/148456739/148456734/{circular:148456742}",
      //   });
    });
  });
});
